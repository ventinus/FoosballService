"use strict";
const fs = require("fs");
const os = require("os");
const path = require("path");
const fs_utils_1 = require("./fs-utils");
module.exports = {
    fromTree: {
        'basic usage'(test) {
            // GIVEN
            const tree = `
      ├── foo
      └── dir
        └── subdir/
          └── bar.txt`;
            // THEN
            const { directory, cleanup } = fs_utils_1.FsUtils.fromTree('basic-usage', tree);
            test.ok(fs.existsSync(path.join(directory, 'foo')));
            test.ok(fs.existsSync(path.join(directory, 'dir', 'subdir', 'bar.txt')));
            cleanup();
            test.ok(!fs.existsSync(path.join(directory, 'foo')));
            test.ok(!fs.existsSync(path.join(directory, 'dir', 'subdir', 'bar.txt')));
            test.ok(!fs.existsSync(directory));
            test.done();
        },
        'symlinks'(test) {
            // GIVEN
            const tree = `
      ├── link -> target
      ├── other_link=>target
      ├── target
          └── foo.txt`;
            // THEN
            const { directory, cleanup } = fs_utils_1.FsUtils.fromTree('symlink', tree);
            test.ok(fs.existsSync(path.join(directory, 'target', 'foo.txt')));
            test.ok(fs.existsSync(path.join(directory, 'link', 'foo.txt')));
            test.ok(fs.existsSync(path.join(directory, 'other_link', 'foo.txt')));
            test.equal(fs.readlinkSync(path.join(directory, 'link')), 'target');
            test.equal(fs.readlinkSync(path.join(directory, 'other_link')), 'target');
            cleanup();
            test.ok(!fs.existsSync(path.join(directory, 'target')));
            test.ok(!fs.existsSync(path.join(directory, 'link')));
            test.ok(!fs.existsSync(path.join(directory, 'other_link')));
            test.ok(!fs.existsSync(directory));
            test.done();
        },
        'external smylinks'(test) {
            // GIVEN
            const externalTree = fs_utils_1.FsUtils.fromTree('external', `
        ├── external_dir
        │   ├── foobar.txt`);
            // THEN
            const externalRelativeDirectory = path.relative(os.tmpdir(), externalTree.directory);
            const externalLink = `../${externalRelativeDirectory}/external_dir`;
            const internalTree = fs_utils_1.FsUtils.fromTree('internal', `
        ├── external_link -> ${externalLink}`);
            test.ok(fs.existsSync(path.join(externalTree.directory, 'external_dir', 'foobar.txt')));
            test.ok(fs.existsSync(path.join(internalTree.directory, 'external_link', 'foobar.txt')));
            test.equal(fs.readlinkSync(path.join(internalTree.directory, 'external_link')), externalLink);
            externalTree.cleanup();
            internalTree.cleanup();
            test.ok(!fs.existsSync(path.join(externalTree.directory, 'external_dir')));
            test.ok(!fs.existsSync(path.join(internalTree.directory, 'external_link')));
            test.ok(!fs.existsSync(internalTree.directory));
            test.ok(!fs.existsSync(externalTree.directory));
            test.done();
        },
        'empty directory'(test) {
            // GIVEN
            const tree = `
      ├── dir (D)`;
            // THEN
            const { directory, cleanup } = fs_utils_1.FsUtils.fromTree('empty-directory', tree);
            test.ok(fs.existsSync(path.join(directory, 'dir')));
            cleanup();
            test.ok(!fs.existsSync(path.join(directory, 'dir')));
            test.ok(!fs.existsSync(directory));
            test.done();
        },
        'works with any indent'(test) {
            // GIVEN
            const tree = `



      ├── foo
      └── dir
       └── subdir
                                        └── bar.txt


                                        `;
            // THEN
            const { directory, cleanup } = fs_utils_1.FsUtils.fromTree('any-indent', tree);
            test.ok(fs.existsSync(path.join(directory, 'foo')));
            test.ok(fs.existsSync(path.join(directory, 'dir', 'subdir', 'bar.txt')));
            cleanup();
            test.ok(!fs.existsSync(path.join(directory, 'foo')));
            test.ok(!fs.existsSync(path.join(directory, 'dir', 'subdir', 'bar.txt')));
            test.ok(!fs.existsSync(directory));
            test.done();
        },
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5mcy11dGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRlc3QuZnMtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHlCQUEwQjtBQUUxQix5QkFBMEI7QUFDMUIsNkJBQThCO0FBQzlCLHlDQUFxQztBQUVyQyxpQkFBUztJQUNQLFFBQVEsRUFBRTtRQUNSLGFBQWEsQ0FBQyxJQUFVO1lBQ3RCLFFBQVE7WUFDUixNQUFNLElBQUksR0FBRzs7OztzQkFJRyxDQUFDO1lBRWpCLE9BQU87WUFDUCxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxHQUFHLGtCQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUVyRSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV6RSxPQUFPLEVBQUUsQ0FBQztZQUVWLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBRW5D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QyxDQUFDO1lBRW5DLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNkLENBQUM7S0FDRjtDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgPSByZXF1aXJlKCdmcycpO1xuaW1wb3J0IHsgVGVzdCB9IGZyb20gJ25vZGV1bml0JztcbmltcG9ydCBvcyA9IHJlcXVpcmUoJ29zJyk7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmltcG9ydCB7IEZzVXRpbHMgfSBmcm9tICcuL2ZzLXV0aWxzJztcblxuZXhwb3J0ID0ge1xuICBmcm9tVHJlZToge1xuICAgICdiYXNpYyB1c2FnZScodGVzdDogVGVzdCkge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IHRyZWUgPSBgXG4gICAgICDilJzilIDilIAgZm9vXG4gICAgICDilJTilIDilIAgZGlyXG4gICAgICAgIOKUlOKUgOKUgCBzdWJkaXIvXG4gICAgICAgICAg4pSU4pSA4pSAIGJhci50eHRgO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBjb25zdCB7IGRpcmVjdG9yeSwgY2xlYW51cCB9ID0gRnNVdGlscy5mcm9tVHJlZSgnYmFzaWMtdXNhZ2UnLCB0cmVlKTtcblxuICAgICAgdGVzdC5vayhmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdmb28nKSkpO1xuICAgICAgdGVzdC5vayhmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdkaXInLCAnc3ViZGlyJywgJ2Jhci50eHQnKSkpO1xuXG4gICAgICBjbGVhbnVwKCk7XG5cbiAgICAgIHRlc3Qub2soIWZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGRpcmVjdG9yeSwgJ2ZvbycpKSk7XG4gICAgICB0ZXN0Lm9rKCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdkaXInLCAnc3ViZGlyJywgJ2Jhci50eHQnKSkpO1xuICAgICAgdGVzdC5vayghZnMuZXhpc3RzU3luYyhkaXJlY3RvcnkpKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAnc3ltbGlua3MnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCB0cmVlID0gYFxuICAgICAg4pSc4pSA4pSAIGxpbmsgLT4gdGFyZ2V0XG4gICAgICDilJzilIDilIAgb3RoZXJfbGluaz0+dGFyZ2V0XG4gICAgICDilJzilIDilIAgdGFyZ2V0XG4gICAgICAgICAg4pSU4pSA4pSAIGZvby50eHRgO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBjb25zdCB7IGRpcmVjdG9yeSwgY2xlYW51cCB9ID0gRnNVdGlscy5mcm9tVHJlZSgnc3ltbGluaycsIHRyZWUpO1xuXG4gICAgICB0ZXN0Lm9rKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGRpcmVjdG9yeSwgJ3RhcmdldCcsICdmb28udHh0JykpKTtcbiAgICAgIHRlc3Qub2soZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oZGlyZWN0b3J5LCAnbGluaycsICdmb28udHh0JykpKTtcbiAgICAgIHRlc3Qub2soZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oZGlyZWN0b3J5LCAnb3RoZXJfbGluaycsICdmb28udHh0JykpKTtcbiAgICAgIHRlc3QuZXF1YWwoZnMucmVhZGxpbmtTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdsaW5rJykpLCAndGFyZ2V0Jyk7XG4gICAgICB0ZXN0LmVxdWFsKGZzLnJlYWRsaW5rU3luYyhwYXRoLmpvaW4oZGlyZWN0b3J5LCAnb3RoZXJfbGluaycpKSwgJ3RhcmdldCcpO1xuXG4gICAgICBjbGVhbnVwKCk7XG5cbiAgICAgIHRlc3Qub2soIWZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGRpcmVjdG9yeSwgJ3RhcmdldCcpKSk7XG4gICAgICB0ZXN0Lm9rKCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdsaW5rJykpKTtcbiAgICAgIHRlc3Qub2soIWZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGRpcmVjdG9yeSwgJ290aGVyX2xpbmsnKSkpO1xuICAgICAgdGVzdC5vayghZnMuZXhpc3RzU3luYyhkaXJlY3RvcnkpKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAnZXh0ZXJuYWwgc215bGlua3MnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCBleHRlcm5hbFRyZWUgPSBGc1V0aWxzLmZyb21UcmVlKCdleHRlcm5hbCcsIGBcbiAgICAgICAg4pSc4pSA4pSAIGV4dGVybmFsX2RpclxuICAgICAgICDilILCoMKgIOKUnOKUgOKUgCBmb29iYXIudHh0YCk7XG5cbiAgICAgIC8vIFRIRU5cblxuICAgICAgY29uc3QgZXh0ZXJuYWxSZWxhdGl2ZURpcmVjdG9yeSA9IHBhdGgucmVsYXRpdmUob3MudG1wZGlyKCksIGV4dGVybmFsVHJlZS5kaXJlY3RvcnkpO1xuICAgICAgY29uc3QgZXh0ZXJuYWxMaW5rID0gYC4uLyR7ZXh0ZXJuYWxSZWxhdGl2ZURpcmVjdG9yeX0vZXh0ZXJuYWxfZGlyYDtcblxuICAgICAgY29uc3QgaW50ZXJuYWxUcmVlID0gRnNVdGlscy5mcm9tVHJlZSgnaW50ZXJuYWwnLCBgXG4gICAgICAgIOKUnOKUgOKUgCBleHRlcm5hbF9saW5rIC0+ICR7ZXh0ZXJuYWxMaW5rfWApO1xuXG4gICAgICB0ZXN0Lm9rKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGV4dGVybmFsVHJlZS5kaXJlY3RvcnksICdleHRlcm5hbF9kaXInLCAnZm9vYmFyLnR4dCcpKSk7XG4gICAgICB0ZXN0Lm9rKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGludGVybmFsVHJlZS5kaXJlY3RvcnksICdleHRlcm5hbF9saW5rJywgJ2Zvb2Jhci50eHQnKSkpO1xuICAgICAgdGVzdC5lcXVhbChmcy5yZWFkbGlua1N5bmMocGF0aC5qb2luKGludGVybmFsVHJlZS5kaXJlY3RvcnksICdleHRlcm5hbF9saW5rJykpLCBleHRlcm5hbExpbmspO1xuXG4gICAgICBleHRlcm5hbFRyZWUuY2xlYW51cCgpO1xuICAgICAgaW50ZXJuYWxUcmVlLmNsZWFudXAoKTtcblxuICAgICAgdGVzdC5vayghZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oZXh0ZXJuYWxUcmVlLmRpcmVjdG9yeSwgJ2V4dGVybmFsX2RpcicpKSk7XG4gICAgICB0ZXN0Lm9rKCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihpbnRlcm5hbFRyZWUuZGlyZWN0b3J5LCAnZXh0ZXJuYWxfbGluaycpKSk7XG4gICAgICB0ZXN0Lm9rKCFmcy5leGlzdHNTeW5jKGludGVybmFsVHJlZS5kaXJlY3RvcnkpKTtcbiAgICAgIHRlc3Qub2soIWZzLmV4aXN0c1N5bmMoZXh0ZXJuYWxUcmVlLmRpcmVjdG9yeSkpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuICAgICdlbXB0eSBkaXJlY3RvcnknKHRlc3Q6IFRlc3QpIHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCB0cmVlID0gYFxuICAgICAg4pSc4pSA4pSAIGRpciAoRClgO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBjb25zdCB7IGRpcmVjdG9yeSwgY2xlYW51cCB9ID0gRnNVdGlscy5mcm9tVHJlZSgnZW1wdHktZGlyZWN0b3J5JywgdHJlZSk7XG5cbiAgICAgIHRlc3Qub2soZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oZGlyZWN0b3J5LCAnZGlyJykpKTtcblxuICAgICAgY2xlYW51cCgpO1xuXG4gICAgICB0ZXN0Lm9rKCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdkaXInKSkpO1xuICAgICAgdGVzdC5vayghZnMuZXhpc3RzU3luYyhkaXJlY3RvcnkpKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgICAnd29ya3Mgd2l0aCBhbnkgaW5kZW50Jyh0ZXN0OiBUZXN0KSB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgdHJlZSA9IGBcblxuXG5cbiAgICAgIOKUnOKUgOKUgCBmb29cbiAgICAgIOKUlOKUgOKUgCBkaXJcbiAgICAgICDilJTilIDilIAgc3ViZGlyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSU4pSA4pSAIGJhci50eHRcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDtcblxuICAgICAgLy8gVEhFTlxuICAgICAgY29uc3QgeyBkaXJlY3RvcnksIGNsZWFudXAgfSA9IEZzVXRpbHMuZnJvbVRyZWUoJ2FueS1pbmRlbnQnLCB0cmVlKTtcblxuICAgICAgdGVzdC5vayhmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdmb28nKSkpO1xuICAgICAgdGVzdC5vayhmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdkaXInLCAnc3ViZGlyJywgJ2Jhci50eHQnKSkpO1xuXG4gICAgICBjbGVhbnVwKCk7XG5cbiAgICAgIHRlc3Qub2soIWZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGRpcmVjdG9yeSwgJ2ZvbycpKSk7XG4gICAgICB0ZXN0Lm9rKCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJlY3RvcnksICdkaXInLCAnc3ViZGlyJywgJ2Jhci50eHQnKSkpO1xuICAgICAgdGVzdC5vayghZnMuZXhpc3RzU3luYyhkaXJlY3RvcnkpKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgfSxcbn07Il19